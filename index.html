<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower Island - Fresh Flowers for Every Occasion</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="header"></div>
    <div id="nav"></div>
    <div id="page-content"></div>

    <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ—É—Ç–µ—Ä (–∫–∞–∫ –Ω–∞ –º–∞–∫–µ—Ç–µ) -->
    <div id="footer">
        <footer class="footer">
            <div class="footer-content">
                <!-- Column 1: Flower Shop text -->
                <div class="footer-section">
                    <h3>Flower <strong>Shop</strong></h3>
                    <p>Everything about the flower shop and a couple of other little things.</p>
                    <p>Everything about the flower shop and a couple of other little things.</p>
                    <p>Everything about the flower shop and a couple of other little things.</p>
                </div>

                <!-- Column 2: Links -->
                <div class="footer-section">
                    <h3>Links</h3>
                    <ul>
                        <li><a href="#flowers">Home</a></li>
                        <li><a href="#best-sellers">Shop</a></li>
                        <li><a href="#latest-posts">About</a></li>
                        <li><a href="#contact">contact</a></li>
                    </ul>
                </div>

                <!-- Column 3: Links -->
                <div class="footer-section">
                    <h3>Links</h3>
                    <ul>
                        <li><a href="#flowers">Home</a></li>
                        <li><a href="#best-sellers">Shop</a></li>
                        <li><a href="#latest-posts">About</a></li>
                        <li><a href="#contact">contact</a></li>
                    </ul>
                </div>

                <!-- Column 4: Contact -->
                <div class="footer-section">
                    <h3>Contact</h3>
                    <ul>
                        <li>üìç 25995 Brighton Lane, Lake Forest, CA</li>
                        <li>‚úâÔ∏è supports@Flowers.com</li>
                        <li>üìû +1 234 5479</li>
                    </ul>
                </div>
            </div>
        </footer>
    </div>

</body>
<script src="search.js"></script>
<script>
    // ===== –ê–î–ê–ü–¢–ò–í–ù–û–ï –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–û–ï –ú–ï–ù–Æ =====
    class MobileMenuManager {
        constructor() {
            this.mobileMenuToggle = document.getElementById('mobileMenuToggle');
            this.mobileNav = document.getElementById('mobileNav');
            this.mobileNavOverlay = document.getElementById('mobileNavOverlay');
            this.mobileNavClose = document.getElementById('mobileNavClose');
            
            this.init();
        }
        
        init() {
            // –ö–ª–∏–∫ –Ω–∞ –≥–∞–º–±—É—Ä–≥–µ—Ä - –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
            this.mobileMenuToggle?.addEventListener('click', () => {
                this.toggleMobileMenu();
            });
            
            // –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
            this.mobileNavClose?.addEventListener('click', () => {
                this.closeMobileMenu();
            });
            
            // –ö–ª–∏–∫ –Ω–∞ overlay - –∑–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
            this.mobileNavOverlay?.addEventListener('click', () => {
                this.closeMobileMenu();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø—É–Ω–∫—Ç –º–µ–Ω—é
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', () => {
                    this.closeMobileMenu();
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.mobileNav?.classList.contains('active')) {
                    this.closeMobileMenu();
                }
            });
        }
        
        toggleMobileMenu() {
            const isActive = this.mobileNav?.classList.contains('active');
            
            if (isActive) {
                this.closeMobileMenu();
            } else {
                this.openMobileMenu();
            }
        }
        
        openMobileMenu() {
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            this.mobileMenuToggle?.classList.add('active');
            this.mobileNav?.classList.add('active');
            this.mobileNavOverlay?.classList.add('active');

            // Accessibility
            this.mobileMenuToggle?.setAttribute('aria-expanded', 'true');
            this.mobileNavOverlay?.setAttribute('aria-hidden', 'false');
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª body
            document.body.style.overflow = 'hidden';
        }
        
        closeMobileMenu() {
            // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é
            this.mobileMenuToggle?.classList.remove('active');
            this.mobileNav?.classList.remove('active');
            this.mobileNavOverlay?.classList.remove('active');

            // Accessibility
            this.mobileMenuToggle?.setAttribute('aria-expanded', 'false');
            this.mobileNavOverlay?.setAttribute('aria-hidden', 'true');
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª body
            document.body.style.overflow = '';
        }
    }
</script>
<script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ header.html
    async function loadPartial(targetId, filePath) {
        const target = document.getElementById(targetId);
        if (!target) return;
        const response = await fetch(filePath);
        if (!response.ok) throw new Error(`${filePath}: ${response.status}`);
        target.outerHTML = await response.text();
    }

    async function loadPageContent(filePath) {
        const target = document.getElementById('page-content');
        if (!target) return;
        const response = await fetch(filePath);
        if (!response.ok) throw new Error(`${filePath}: ${response.status}`);
        const html = await response.text();

        const parsed = new DOMParser().parseFromString(html, 'text/html');
        const body = parsed.body;
        if (body) {
            const isFooterPartial = filePath?.includes('footer.html');
            const selectorsToRemove = [
                'header, .header',
                'nav#mobileNav, .mobile-nav',
                '#mobileNavOverlay, .mobile-nav-overlay',
                'nav.desktop-nav',
                'script, link, style',
            ];
            // –ï—Å–ª–∏ –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–∞–º footer.html –∫–∞–∫ –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –Ω–µ –≤—ã—Ä–µ–∑–∞–µ–º —Ñ—É—Ç–µ—Ä.
            if (!isFooterPartial) selectorsToRemove.push('footer, .footer');

            body.querySelectorAll(selectorsToRemove.join(', ')).forEach((el) => el.remove());

            const main = body.querySelector('main');
            if (main) {
                let resultHtml = main.outerHTML;
                let node = main.nextSibling;
                while (node) {
                    if (node.nodeType === Node.ELEMENT_NODE) {
                        const el = node;
                        const excluded = isFooterPartial
                            ? 'header, .header, nav, script, link, style'
                            : 'header, .header, footer, .footer, nav, script, link, style';
                        if (!el.matches(excluded)) {
                            resultHtml += el.outerHTML;
                        }
                    }
                    node = node.nextSibling;
                }
                target.outerHTML = resultHtml;
                return;
            }

            const cleaned = body.innerHTML.trim();
            if (cleaned) {
                target.outerHTML = cleaned;
            } else {
                target.outerHTML = '';
            }
            return;
        }

        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å HTML, –Ω–µ –≤—Å—Ç–∞–≤–ª—è–µ–º –Ω–∏—á–µ–≥–æ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É—Ç–µ—Ä–æ–≤
        target.outerHTML = '';
    }

    function getPageContentFromUrl() {
        const params = new URLSearchParams(window.location.search);
        const value = params.get('page-content');
        if (!value) return null;
        if (value.includes('..') || value.includes('://') || value.startsWith('/')) return null;
        return value;
    }

    function isContentOnlyPage(pageContent) {
        if (!pageContent) return false;
        return [
            'product-detail.html',
            'product-search.html',
            'cart.html',
            'login.html',
            'footer.html',
        ].some((name) => pageContent.includes(name));
    }

    // Initialize cart functionality
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const pageContent = getPageContentFromUrl() || 'main.html';
            const contentOnly = isContentOnlyPage(pageContent);
            
            if (!contentOnly) {
                await loadPartial('header', 'header.html');
                await loadPartial('nav', 'nav.html');
            }
            
            await loadPageContent(pageContent);

            if (!contentOnly) {
                await loadPartial('footer', 'footer.html');
            } else {
                ['header', 'nav', 'footer'].forEach((id) => {
                    document.getElementById(id)?.remove();
                });
            }

            // –û—á–∏—â–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ header –∏ nav –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
            if (!contentOnly) {
                document.querySelectorAll('.header').forEach((el, idx) => {
                    if (idx > 0) el.remove();
                });
                document.querySelectorAll('nav#mobileNav, nav.mobile-nav').forEach((el, idx) => {
                    if (idx > 0) el.remove();
                });
                document.querySelectorAll('#mobileNavOverlay, .mobile-nav-overlay').forEach((el, idx) => {
                    if (idx > 0) el.remove();
                });
            }
        } catch (error) {
            console.error('Partial –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è:', error);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ header –∏ nav –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        const pageContent = getPageContentFromUrl() || 'main.html';
        if (!isContentOnlyPage(pageContent)) {
            const mobileMenuManager = new MobileMenuManager();
        }
        
        const cartManager = (typeof CartManager !== 'undefined') ? new CartManager() : null;
        
        if (cartManager) {
            // Add to cart functionality for all add to cart buttons
            const addToCartBtns = document.querySelectorAll('.btn-add-cart');
            addToCartBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const product = {
                        id: parseInt(btn.dataset.productId),
                        name: btn.dataset.productName,
                        price: parseFloat(btn.dataset.productPrice),
                        image: btn.dataset.productImage,
                        description: `${btn.dataset.productName.toLowerCase()} flower`
                    };
                    cartManager.addToCart(product);
                });
            });
        }
    });
</script>
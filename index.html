<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower Island - Fresh Flowers for Every Occasion</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="header"></div>
    <div id="nav"></div>
    <div id="page-content"></div>
    <div id="footer"></div>

</body>
<script src="search.js"></script>
<script>
    // Mobile Menu Functionality
    document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileNav = document.getElementById('mobileNav');
        const mobileNavClose = document.getElementById('mobileNavClose');
        const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
        if (!mobileMenuToggle || !mobileNav || !mobileNavClose) {
            return;
        }
        
        // Create overlay
        const overlay = document.createElement('div');
        overlay.className = 'mobile-nav-overlay';
        document.body.appendChild(overlay);
        
        function openMobileMenu() {
            mobileNav.classList.add('active');
            mobileMenuToggle.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeMobileMenu() {
            mobileNav.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // Toggle menu
        mobileMenuToggle.addEventListener('click', openMobileMenu);
        
        // Close menu
        mobileNavClose.addEventListener('click', closeMobileMenu);
        overlay.addEventListener('click', closeMobileMenu);
        
        // Close menu when clicking links
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', () => {
                closeMobileMenu();
            });
        });
        
        // Close menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
                closeMobileMenu();
            }
        });
    });
    
    // ===== АДАПТИВНОЕ НАВИГАЦИОННОЕ МЕНЮ =====
    class MobileMenuManager {
        constructor() {
            this.mobileMenuToggle = document.getElementById('mobileMenuToggle');
            this.mobileNav = document.getElementById('mobileNav');
            this.mobileNavOverlay = document.getElementById('mobileNavOverlay');
            this.mobileNavClose = document.getElementById('mobileNavClose');
            
            this.init();
        }
        
        init() {
            // Клик на гамбургер - открытие/закрытие меню
            this.mobileMenuToggle?.addEventListener('click', () => {
                this.toggleMobileMenu();
            });
            
            // Клик на кнопку закрытия
            this.mobileNavClose?.addEventListener('click', () => {
                this.closeMobileMenu();
            });
            
            // Клик на overlay - закрытие меню
            this.mobileNavOverlay?.addEventListener('click', () => {
                this.closeMobileMenu();
            });
            
            // Закрытие меню при клике на пункт меню
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', () => {
                    this.closeMobileMenu();
                });
            });
            
            // Закрытие меню при нажатии ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.mobileNav?.classList.contains('active')) {
                    this.closeMobileMenu();
                }
            });
        }
        
        toggleMobileMenu() {
            const isActive = this.mobileNav?.classList.contains('active');
            
            if (isActive) {
                this.closeMobileMenu();
            } else {
                this.openMobileMenu();
            }
        }
        
        openMobileMenu() {
            // Добавляем классы для открытия меню
            this.mobileMenuToggle?.classList.add('active');
            this.mobileNav?.classList.add('active');
            this.mobileNavOverlay?.classList.add('active');
            
            // Блокируем скролл body
            document.body.style.overflow = 'hidden';
        }
        
        closeMobileMenu() {
            // Удаляем классы для закрытия меню
            this.mobileMenuToggle?.classList.remove('active');
            this.mobileNav?.classList.remove('active');
            this.mobileNavOverlay?.classList.remove('active');
            
            // Возвращаем скролл body
            document.body.style.overflow = '';
        }
    }
</script>
<script>
    // Загрузка header.html
    async function loadPartial(targetId, filePath) {
        const target = document.getElementById(targetId);
        if (!target) return;
        const response = await fetch(filePath);
        if (!response.ok) throw new Error(`${filePath}: ${response.status}`);
        target.outerHTML = await response.text();
    }

    async function loadPageContent(filePath) {
        const target = document.getElementById('page-content');
        if (!target) return;
        const response = await fetch(filePath);
        if (!response.ok) throw new Error(`${filePath}: ${response.status}`);
        const html = await response.text();

        const parsed = new DOMParser().parseFromString(html, 'text/html');
        const body = parsed.body;
        if (body) {
            body.querySelectorAll(
                'header, .header, footer, .footer, nav#mobileNav, .mobile-nav, #mobileNavOverlay, .mobile-nav-overlay, nav.desktop-nav, script, link, style'
            ).forEach((el) => el.remove());

            const main = body.querySelector('main');
            if (main) {
                let resultHtml = main.outerHTML;
                let node = main.nextSibling;
                while (node) {
                    if (node.nodeType === Node.ELEMENT_NODE) {
                        const el = node;
                        if (!el.matches('header, .header, footer, .footer, nav, script, link, style')) {
                            resultHtml += el.outerHTML;
                        }
                    }
                    node = node.nextSibling;
                }
                target.outerHTML = resultHtml;
                return;
            }

            const cleaned = body.innerHTML.trim();
            target.outerHTML = cleaned || html;
            return;
        }

        target.outerHTML = html;
    }

    function getPageContentFromUrl() {
        const params = new URLSearchParams(window.location.search);
        const value = params.get('page-content');
        if (!value) return null;
        if (value.includes('..') || value.includes('://') || value.startsWith('/')) return null;
        return value;
    }

    // Initialize cart functionality
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            await loadPartial('header', 'header.html');
            await loadPartial('nav', 'nav.html');
            const pageContent = getPageContentFromUrl() || 'main.html';
            await loadPageContent(pageContent);

            document.querySelectorAll('.header').forEach((el, idx) => {
                if (idx > 0) el.remove();
            });
            document.querySelectorAll('nav#mobileNav, nav.mobile-nav').forEach((el, idx) => {
                if (idx > 0) el.remove();
            });
            document.querySelectorAll('#mobileNavOverlay, .mobile-nav-overlay').forEach((el, idx) => {
                if (idx > 0) el.remove();
            });
        } catch (error) {
            console.error('Partial не загрузился:', error);
        }
        
        // Инициализируем мобильное меню
        const mobileMenuManager = new MobileMenuManager();
        
        const cartManager = (typeof CartManager !== 'undefined') ? new CartManager() : null;
        
        if (cartManager) {
            // Add to cart functionality for all add to cart buttons
            const addToCartBtns = document.querySelectorAll('.btn-add-cart');
            addToCartBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const product = {
                        id: parseInt(btn.dataset.productId),
                        name: btn.dataset.productName,
                        price: parseFloat(btn.dataset.productPrice),
                        image: btn.dataset.productImage,
                        description: `${btn.dataset.productName.toLowerCase()} flower`
                    };
                    cartManager.addToCart(product);
                });
            });
        }
    });
</script>

<script>
    // Simple Mobile Menu Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileNav = document.getElementById('mobileNav');
        const mobileNavOverlay = document.getElementById('mobileNavOverlay');
        const mobileNavClose = document.getElementById('mobileNavClose');
        
        if (mobileMenuToggle && mobileNav && mobileNavOverlay) {
            mobileMenuToggle.addEventListener('click', function() {
                mobileNav.classList.toggle('active');
                mobileNavOverlay.classList.toggle('active');
                document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : '';
            });
            
            if (mobileNavClose) {
                mobileNavClose.addEventListener('click', function() {
                    mobileNav.classList.remove('active');
                    mobileNavOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                });
            }
            
            mobileNavOverlay.addEventListener('click', function() {
                mobileNav.classList.remove('active');
                mobileNavOverlay.classList.remove('active');
                document.body.style.overflow = '';
            });
        }
    });
</script>